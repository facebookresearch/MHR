[workspace]
name = "mhr"
version = "0.1.0"
description = "Momentum Human Rig"
channels = ["conda-forge", "pytorch"]
platforms = ["linux-64"]

[system-requirements]
libc = { family = "glibc", version = "2.39" }

[dependencies]
python = ">=3.12,<3.14"
pytest = ">=8.0"
conda-build = ">=24.0"

[pypi-dependencies]
mhr = { path = ".", editable = true }
build = ">=1.0"
twine = ">=5.0"

[tasks]
test = "pytest tests/ -v"
build = "python -m build"
publish = "twine upload --repository mhr dist/*"
publish-test = "twine upload --repository testpypi dist/*"
clean = "rm -rf dist build *.egg-info"
conda-build = 'bash -c "conda build conda/ --output-folder ${TMPDIR:-/tmp}/mhr-conda-build/ --croot ${TMPDIR:-/tmp}/mhr-conda-work/ -c conda-forge -c pytorch"'
conda-test = { cmd = 'bash -c "conda create -n mhr-test -y -c ${TMPDIR:-/tmp}/mhr-conda-build/ -c conda-forge -c pytorch mhr && conda run -n mhr-test pytest tests/ -v && conda env remove -n mhr-test -y"', depends-on = ["conda-build"] }
conda-clean = 'bash -c "rm -rf ${TMPDIR:-/tmp}/mhr-conda-build/ ${TMPDIR:-/tmp}/mhr-conda-work/"'

[feature.py312]
dependencies = { python = "3.12.*" }

[feature.py313]
dependencies = { python = "3.13.*" }

[feature.py312-cuda129]
platforms = ["linux-64"]
system-requirements = { cuda = "12" }
dependencies = { python = "3.12.*" }

[feature.py313-cuda129]
platforms = ["linux-64"]
system-requirements = { cuda = "12" }
dependencies = { python = "3.13.*" }

[environments]
default = ["py312"]
py312 = ["py312"]
py313 = ["py313"]
py312-cuda129 = ["py312-cuda129"]
py313-cuda129 = ["py313-cuda129"]
